<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui" 
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    
<f:view beforePhase="#{bKBLogin.beforePhase}" afterPhase="#{bKBLogin.afterPhase}"  encoding="UTF-8" >
 
<h:head>
    <title>cargotracking</title>
    
    <h:outputStylesheet name="NSTDAnew1.css" library="css" />
    <h:outputStylesheet name="style_s.css" library="css" />
    <h:outputScript name="f1common.js" library="js" />
    
<!--[if lte IE 6]>
	<script type="text/javascript" src="app/js/supersleight-min.js"></script>
<![endif]-->

<script type="text/javascript">
   
//<![CDATA[ 


function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}

function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

function MM_findObj(n, d) { //v4.01
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && d.getElementById) x=d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}

function lp_fullscreen(){
    
    //MM_preloadImages('images/btt_login_over.gif','images/btt_cancel_over.gif');
    
    //top.window.moveTo(0,0);
    //top.window.resizeTo ( screen.availWidth,screen.availHeight );
    
}


function lonload() {
    
   
}

function startsign(){
    //alert('aaa');
    
    //signrow();
    //document.getElementById('form1:bttlo').click();
    
    document.getElementById('form1:bttlo').click();
    
}


function signNotify(status, refId, sigBlobId, sigParts, appref){
    
    //getbyid("form1:signrefid").value    = refId;
    
    //alert(status +": " + refId + "\r\n SigXBlob: " + sigBlobId + "/" + sigParts);
        
        window.status   = "finish "+status;
                //+"//"+refId;
        
        cursordefault();
        
        if(status == "YES"){
            //alert("การเข้าถึงใบรับรอง ok " +signer+"/"+status+"/"+ refId);
            
            //document.getElementById('form1:signrefid').value    = refId;
            //document.getElementById('form1:savesend').click();
            
            if(refId == ""){
                showMsgError("การยืนยัน certificate ของผู้ใช้ไม่สำเร็จ กรุณาเข้าสู่ระบบอีกครั้ง");
            }else{
            
                document.getElementById('form1:sri').value    = refId;
                document.getElementById('form1:bttlo').click();
            }

        }else{
            
            //alert("การเข้าถึงใบรับรองไม่ถูกต้อง  \r\n "+status+"/"+ refId);
            //document.getElementById('form1:savesendo').click();
            
            //checkcertcancel.show()
            
            showMsgError("การยืนยัน certificate ของผู้ใช้ไม่สำเร็จ");
            
            
            //alert("certificate ไม่ถูกต้อง");
            
        }
        
        //
}

function gologin(){
    //alert('ss');  
    document.getElementById('form1:savesendo').click();
    
}

//function showMsgError(message){
//    
//     var msg    = document.getElementById('errmsg');
//   
//        msg.innerHTML   = message;
//        
//     msldlg1.show();   
//}
   
//]]> 
</script>

</h:head>
<h:body   onload="lp_fullscreen();lonload();" style="background-image: url('#{resource['images/loginnew1/bg.jpg']}');">

<h:form id="form1" >

    
<ui:remove><!--
      <p:focus />   
--></ui:remove>
    
<p:poll interval="600" immediate="true" listener="#{bKBLogin.poll}" />  


<table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
	<tr>
        <td id="login_bg" align="center" valign="top" style="padding-top:40px;">
                <table border="0" cellpadding="0" cellspacing="0">
        <tr> 
          <td width="498" height="408" id="login01"> </td>
          <td width="317" height="408" align="center" valign="top" id="login02"> 
              <div style="padding-top:110px;padding-right:40px;">
              <p:outputPanel id="logonpan" >
              <table width="200" border="0" cellspacing="0" cellpadding="0">
                <tr> 
                  <td height="40" colspan="3"><div align="center">
                          <img src="#{resource['images/loginnew1/txt_login.png']}" width="63" height="24" /></div></td>
                    
                </tr>
                <tr> 
                  <td width="66" height="40"><img src="#{resource['images/loginnew1/txt_id.png']}" width="63" height="24" /></td>
                  <td width="3" height="40">&nbsp;</td>
                  <td width="131" height="40"> <p:inputText label="รหัสผู้ใช้"  value="#{bKBLogin.uiuserid}" 
                                                            rendered="#{not bKBLogin.userLock}"
                                                            size="15" maxlength="15" autocomplete="off"
                                                            id="uiuserid" required="true" styleClass="input_box" >
                                                   <p:ajax  listener="#{bKBLogin.changeUser}" process="@this" 
                                                            update="userout outu2 logonbuttpan :form1:#{bKBAppVar.COMPO_ID_MESSAGES}" />
                                               </p:inputText>
                                               <p:outputLabel rendered="#{bKBLogin.userLock}"
                                                   value="XXXXXXXXXX" ></p:outputLabel>
                  </td>
                </tr>
                <tr> 
                  <td height="40"><img src="#{resource['images/loginnew1/txt_pw.png']}" width="63" height="24" /></td>
                  <td height="40">&nbsp;</td>
                  <td height="40">
                                                    <p:password  label="รหัสผ่าน" size="15" maxlength="30" 
                                                                rendered="#{not bKBLogin.userLock}"
                                                                autocomplete="off"
                                                                value="#{bKBLogin.uiuserpassword}" id="uiuserpassword" 
                                                                required="true" styleClass="input_box"  >
                                                   </p:password>
                                                   <p:outputLabel rendered="#{bKBLogin.userLock}"
                                                       value="XXXXXXXXXX" ></p:outputLabel>
                  </td>
                </tr>
                <tr> 
                  <td height="30" colspan="3">
                      <p:outputPanel id="logonbuttpan" ><div align="center">
                              <p:commandButton  value="" type="button" id="btna1"
                                                onclick="startsign();"
                                                styleClass="butt-login1"
                                                rendered="#{not bKBLogin.userLock}"
                                  >
                              </p:commandButton>

                              <p:commandButton  value=""  id="bttlo" style="display: none;"
                                                ajax="true"
                                                actionListener="#{bKBLogin.logonact()}"
                                                action="#{bKBLogin.logon}"
                                                process="logonpan userout"
                                                update="logonpan :form1:#{bKBAppVar.COMPO_ID_MESSAGES}"
                                  >
                              </p:commandButton>
                              
                              <p:commandButton  value=""  id="btna2" immediate="true"
                                                rendered="#{not bKBLogin.userLock}"
                                                actionListener="#{bKBLogin.changePassword}"
                                                ajax="true" style="display: none;"
                                                styleClass="butt-changepassword1" >
                              </p:commandButton>

                              <p:commandButton  value=""  id="bttlock" style="display: none;"
                                                ajax="true"
                                                process="@none"
                                                update="logonpan"
                                  >
                                  </p:commandButton>

                    </div></p:outputPanel></td>
                </tr>
              </table>
              </p:outputPanel>
            </div>
            <div style="padding-top:15px;padding-right:43px;"> </div></td>
        </tr>
      </table>

      <br/>
        </td>
	</tr>
</table>



<p:outputPanel id="userout" style="display: none;">
    <p:inputText size="40" maxlength="40" 
                 value="#{bKBLogin.ckey}" 
                id="uo"  styleClass="input_box" >

   </p:inputText>
    <p:inputText id="sri" size="40" maxlength="40"  
                 value="#{bKBLogin.signrefid}" 
                     styleClass="input_box">
    </p:inputText>
</p:outputPanel>

<p:outputPanel id="outu2">
    
<script type="text/javaScript">
//<![CDATA[ 
function signrow(){
        
    if(document.getElementById("form1:uiuserid").value=="" ||
       document.getElementById("form1:uiuserpassword").value==""  ){

            //alert("กรุณาป้อนรหัสผู้ใช้และรหัสผ่าน");
            //msldlg1.show();

            showMsgError("กรุณาป้อนรหัสผู้ใช้และรหัสผ่าน");

            return ;

       }

    if("#{bKBLogin.ckey}" == ""){

        //alert("ไม่พบข้อมูล certificate ");

        showMsgError("ไม่พบข้อมูล certificate กรุณาตรวจสอบผู้ใช้");
        //showMsgError("การเข้าถึงใบรับรองไม่ถูกต้อง   ไม่พบข้อมูล certificate ไม่พบข้อมูล certificate");

        return ;
    }

    cursorpg();
        
    window.status   = "processing..";

    
    signer_setCert("THP", "#{bKBLogin.tpkey}");

    signer_addMeta("pages", "#{bKBLogin.dataforsign}");

    signer_signDoc("sign0");

    //alert('a3');
}

function chk(){
    if(#{bKBLogin.userLock}){
        document.getElementById('form1:bttlock').click();
    }
}

#{bKBLogin.userLock ? "chk();" :""}

//]]> 
</script>
</p:outputPanel>

<p:defaultCommand target="btna1" />


<ui:include src="#{bKBAppVar.COMPO_MASG}" >
    <ui:param name="basebean" value="#{bKBLogin}"/>
</ui:include>

<ui:include src="#{bKBAppVar.COMPO_MASG_CLIENT}" >
</ui:include>


</h:form>
</h:body>
        
</f:view>
</html>

